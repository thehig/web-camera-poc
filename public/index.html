<html>
  <body>
    <div id="screenshot" style="text-align:center;">
      <video class="videostream" autoplay=""></video>
      <img id="screenshot-img" />
      <p><button class="capture-button">Capture video</button></p>
      <p><button id="screenshot-button" disabled="">Take screenshot</button></p>
    </div>

    <canvas style="display:none;"></canvas>

    <script type="text/javascript">
      const captureVideoButton = document.querySelector( "#screenshot .capture-button" );
      const screenshotButton = document.querySelector("#screenshot-button");
      const img = document.querySelector("#screenshot img");
      const video = document.querySelector("#screenshot video");

      const canvas = document.createElement("canvas");
      
      function handleSuccess(stream) {
        screenshotButton.disabled = false;
        video.srcObject = stream;
      }

      function handleError(err) {
        alert(err);
      }

      captureVideoButton.onclick = function() {
        navigator.mediaDevices
          .getUserMedia()
          .then(handleSuccess)
          .catch(handleError);
      };

      screenshotButton.onclick = video.onclick = function() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        // Other browsers will fall back to image/png
        img.src = canvas.toDataURL("image/webp");
      };

    </script>
  </body>
</html>
