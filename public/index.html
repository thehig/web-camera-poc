<html>
  <body>
    <style>
      a {
        text-align: center;
        display: block;
      }
    </style>
    <div id="screenshot" style="text-align:center;">
      <a href="https://github.com/thehig/web-camera-poc/blob/master/public/index.html">Source</a>
      <video class="videostream" autoplay=""></video>
      <img id="screenshot-img" />
      <p><button class="capture-button">Capture video</button></p>
      <p><button id="screenshot-button" disabled="">Take screenshot</button></p>
    </div>

    <script type="text/javascript">
      // Buttons
      const captureVideoButton = document.querySelector(
        "#screenshot .capture-button"
      );
      const screenshotButton = document.querySelector("#screenshot-button");
      // Video Element
      const video = document.querySelector("#screenshot video");
      // Canvas to render video into
      const canvas = document.createElement("canvas");
      // Image to render canvas into
      const img = document.querySelector("#screenshot img");
      
      let streamReference;
      // Connect stream to video & enable screenshot button
      function handleSuccess(stream) {
        screenshotButton.disabled = false;
        video.srcObject = streamReference = stream;
      }

      // Alert error
      function handleError(err) {
        console.log(err);
        alert(err);
      }

      // Initialize camera feed
      captureVideoButton.onclick = function() {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then(handleSuccess)
          .catch(handleError);
      };

      // Take screenshot
      screenshotButton.onclick = video.onclick = function() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        // draw video to canvas
        canvas.getContext("2d").drawImage(video, 0, 0);
        // draw canvas to image
        img.src = canvas.toDataURL("image/webp");

        let track = streamReference.getTracks()[0];
        track.stop();
      };
    </script>
  </body>
</html>
