<html>
  <body>
    <a href="https://github.com/thehig/web-camera-poc">Github</a>
    <div id="screenshot" style="text-align:center;">
      <video class="videostream" autoplay=""></video>
      <img id="screenshot-img" />
      <p><button class="capture-button">Capture video</button></p>
      <p><button id="screenshot-button" disabled="">Take screenshot</button></p>
    </div>

    <canvas style="display:none;"></canvas>

    <script type="text/javascript">
      // Buttons
      const captureVideoButton = document.querySelector( "#screenshot .capture-button" );
      const screenshotButton = document.querySelector("#screenshot-button");
      // Video Element
      const video = document.querySelector("#screenshot video");
      // Canvas to render video into
      const canvas = document.createElement("canvas");
      // Image to render canvas into
      const img = document.querySelector("#screenshot img");
      
      // Connect stream to video & enable screenshot button
      function handleSuccess(stream) {
        screenshotButton.disabled = false;
        video.srcObject = stream;
      }

      // Alert error
      function handleError(err) {
        console.log(err);
        alert(err);
      }      
      
      // Initialize camera feed
      captureVideoButton.onclick = function() {
        navigator.mediaDevices
          .getUserMedia({ video: true })
          .then(handleSuccess)
          .catch(handleError);
      };

      // Take screenshot
      screenshotButton.onclick = video.onclick = function() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        // draw video to canvas
        canvas.getContext("2d").drawImage(video, 0, 0);
        // draw canvas to image
        img.src = canvas.toDataURL("image/webp");
      };

    </script>
  </body>
</html>
